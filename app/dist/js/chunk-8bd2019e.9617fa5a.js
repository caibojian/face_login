(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-8bd2019e"],{"14b9":function(e,i,s){var t=s("5ca1");t(t.P,"String",{repeat:s("9744")})},"912c":function(e,i,s){},9744:function(e,i,s){"use strict";var t=s("4588"),a=s("be13");e.exports=function(e){var i=String(a(this)),s="",r=t(e);if(r<0||r==1/0)throw RangeError("Count can't be negative");for(;r>0;(r>>>=1)&&(i+=i))1&r&&(s+=i);return s}},efcf:function(e,i,s){"use strict";s.r(i);var t=function(){var e=this,i=e.$createElement,s=e._self._c||i;return s("div",{staticClass:"page"},[e._m(0),s("div",{staticClass:"page__bd"},[s("div",[s("div",{staticClass:"weui-toptips weui-toptips_warn js_tooltips"},[e._v("错误提示")]),e.showVideo?s("div",{attrs:{align:"center"}},[s("video",{ref:"video",staticClass:"video_class",attrs:{id:"video"}}),s("canvas",{ref:"canvas",attrs:{hidden:"true",id:"canvas",width:"200",height:"200"}})]):e._e(),e.showProgress?s("div",{staticClass:"weui-progress",staticStyle:{margin:"10px"}},[s("div",{staticClass:"weui-progress__bar"},[s("div",{staticClass:"weui-progress__inner-bar js_progress",style:e.progress})])]):e._e(),e.isRegister?s("div",{staticClass:"weui-cells"},[s("div",{staticClass:"weui-cell"},[s("div",{staticClass:"weui-cell__bd"},[s("input",{directives:[{name:"model",rawName:"v-model",value:e.username,expression:"username"}],ref:"username",staticClass:"weui-input",attrs:{name:"username",type:"text",tabindex:"1","auto-complete":"on",placeholder:"输入注册名称"},domProps:{value:e.username},on:{input:function(i){i.target.composing||(e.username=i.target.value)}}})])])]):e._e(),s("div",{staticStyle:{"margin-top":"20px",padding:"10px"}},[e.showVideo&&!e.isRegister?s("a",{staticClass:"weui-btn weui-btn_primary",on:{click:e.login}},[e._v("验证")]):e._e(),e.isRegister?s("a",{staticClass:"weui-btn weui-btn_primary",on:{click:e.register}},[e._v("注册")]):e._e(),e.showVideo?s("a",{staticClass:"weui-btn weui-btn_primary",on:{click:e.closeCamera}},[e._v("关闭视频")]):e._e()]),s("div",{staticClass:"weui-flex"},[s("div",{staticClass:"weui-flex__item"},[s("div",{staticClass:"placeholder",staticStyle:{padding:"5px"}},[e.showVideo?e._e():s("a",{staticClass:"weui-btn weui-btn_primary",on:{click:e.startFace}},[e._v("人脸识别")])])]),s("div",{staticClass:"weui-flex__item"},[s("div",{staticClass:"placeholder",staticStyle:{padding:"5px"}},[e.showVideo?e._e():s("a",{staticClass:"weui-btn weui-btn_primary",on:{click:e.registerView}},[e._v("人脸注册")])])])])])]),e.loading?s("div",{attrs:{id:"loadingToast"}},[s("div",{staticClass:"weui-mask_transparent mask"}),e._m(1)]):e._e(),e.showDilog?s("div",{staticClass:"js_dialog",attrs:{id:"iosDialog2"}},[s("div",{staticClass:"weui-mask"}),s("div",{staticClass:"weui-dialog"},[s("div",{staticClass:"weui-dialog__bd"},[e._v(e._s(e.dialogMsg))]),s("div",{staticClass:"weui-dialog__ft"},[s("a",{staticClass:"weui-dialog__btn weui-dialog__btn_primary",attrs:{href:"javascript:;"},on:{click:e.closeDialog}},[e._v("知道了")])])])]):e._e()])},a=[function(){var e=this,i=e.$createElement,s=e._self._c||i;return s("div",{staticClass:"page__hd"},[s("h1",{staticClass:"page__title"},[e._v("人脸识别系统")]),s("p",{staticClass:"page__desc"},[e._v("v1.0.0")])])},function(){var e=this,i=e.$createElement,s=e._self._c||i;return s("div",{staticClass:"weui-toast"},[s("i",{staticClass:"weui-loading weui-icon_toast"}),s("p",{staticClass:"weui-toast__content"},[e._v("数据加载中")])])}],r=(s("14b9"),s("7f7f"),s("c24f")),o={name:"Login",data:function(){return{loading:!1,redirect:void 0,showVideo:!1,showProgress:!1,imgDatas:[],repeat:0,progress:"",mediaStreamTrack:null,isRegister:!1,username:"",panel_loading:!1,dialogMsg:"",showDilog:!1}},watch:{$route:{handler:function(e){this.redirect=e.query&&e.query.redirect},immediate:!0}},methods:{getUserMedia:function(e,i,s){navigator.mediaDevices&&navigator.mediaDevices.getUserMedia?(this.msg="1",navigator.mediaDevices.getUserMedia(e).then(i).catch(s)):navigator.webkitGetUserMedia?(this.msg="2",navigator.webkitGetUserMedia(e,i,s)):navigator.mozGetUserMedia?(this.msg="3",navigator.mozGetUserMedia(e,i,s)):navigator.getUserMedia&&(this.msg="4",navigator.getUserMedia(e,i,s))},success:function(e){this.video_buffer=e;window.URL||window.webkitURL;this.$refs.video.srcObject=e,this.$refs.video.play(),this.loading=!1},error:function(e){this.loading=!1,console.error("访问用户媒体设备失败".concat(e.name,", ").concat(e.message)),this.showDilog=!0,this.dialogMsg="访问用户媒体设备失败"},closeCamera:function(){if(this.video_buffer){if(console.log(this.video_buffer.getTracks()),this.showProgress)return;this.isRegister=!1,this.showVideo=!1,this.video_buffer&&this.video_buffer.getTracks()[0].stop()}},registerView:function(){this.isRegister=!0,this.startFace()},register:function(){var e=this;if(!this.showProgress){if(!this.username)return e.showDilog=!0,void(e.dialogMsg="用户名不能为空，请输入用户名。");e.showProgress=!0,e.imgDatas=[],e.repeat=0,e.progress="width: 0%;";var i=setInterval(function(){e.getPic(),5==e.repeat&&(clearInterval(i),e.headRegister())},500)}},headRegister:function(){var e=this,i=this;this.loading=!0,Object(r["e"])({imgData:this.imgDatas,username:this.username}).then(function(s){s.success||(i.showDilog=!0,i.dialogMsg=s.msg),e.loading=!1,e.showProgress=!1,e.isRegister=!1}).catch(function(){e.loading=!1,e.showProgress=!1})},startFace:function(){var e=this;console.log(navigator.mediaDevices),console.log(navigator.getUserMedia),console.log(navigator.webkitGetUserMedia),console.log(navigator.mozGetUserMedia),navigator.mediaDevices&&navigator.mediaDevices.getUserMedia||navigator.getUserMedia||navigator.webkitGetUserMedia||navigator.mozGetUserMedia?(this.loading=!0,e.getUserMedia({video:{width:300,height:300,facingMode:"user"}},e.success,e.error)):(this.loading=!1,console.error("不支持访问用户媒体"),this.showDilog=!0,this.dialogMsg="不支持访问用户媒体"),e.showVideo=!0},getPic:function(){var e=this;e.repeat++,e.progress="width: "+20*e.repeat+"%;";var i=e.$refs.canvas,s=i.getContext("2d");i.width=300,i.height=300,s.drawImage(e.$refs.video,0,0,300,300);var t=i.toDataURL();e.imgDatas.push(t)},login:function(){var e=this;if(!this.showProgress){e.showProgress=!0,e.imgDatas=[],e.repeat=0,e.progress="width: 0%;";var i=setInterval(function(){e.getPic(),5==e.repeat&&(clearInterval(i),e.handleLogin())},500)}},handleLogin:function(){var e=this,i=this;this.loading=!0,this.$store.dispatch("user/facelogin",{imgData:this.imgDatas}).then(function(){console.log(e.$store.getters.token),e.showProgress=!1,i.closeCamera(),e.$store.getters.token?e.$router.push({path:e.redirect||"/"}):(i.showDilog=!0,i.dialogMsg="验证失败，请重试！"),e.loading=!1}).catch(function(){i.closeCamera(),e.loading=!1,e.showProgress=!1})},closeDialog:function(){this.showDilog=!1}}},n=o,c=(s("f47f"),s("2877")),g=Object(c["a"])(n,t,a,!1,null,null,null);i["default"]=g.exports},f47f:function(e,i,s){"use strict";var t=s("912c"),a=s.n(t);a.a}}]);
//# sourceMappingURL=chunk-8bd2019e.9617fa5a.js.map